# 计划：创建 LiveKit 直播测试页面

## 目标

在前端 `front/` 项目中创建一个新的页面，用于测试 LiveKit 的直播功能，支持用户作为主播发起直播或作为观众观看直播。

## 前提条件

*   前端项目使用 Next.js App Router 结构。
*   后端已提供生成 LiveKit 访问令牌 (Access Token) 的接口。
*   UI 风格使用基础界面即可。

## 计划步骤

1.  **创建新页面路由:**
    *   在 `front/src/app/` 目录下创建路由文件 `livekit-test/page.tsx`。

2.  **安装 LiveKit 客户端 SDK:**
    *   在 `front/` 目录下执行 `pnpm add livekit-client` (或相应的包管理器命令)。

3.  **实现基础 UI 组件:**
    *   **输入区域:** 提供用户名和房间名输入框。
    *   **控制按钮:**
        *   “加入房间”/“离开房间”按钮。
        *   “开始直播”/“停止直播”按钮（仅主播可见）。
        *   麦克风和摄像头切换按钮。
    *   **视频显示区域:**
        *   一个用于显示本地视频预览的区域。
        *   一个用于网格化显示所有远程参与者视频的区域。

4.  **实现 LiveKit 连接逻辑:**
    *   **获取 Token:** 调用现有的后端接口获取 LiveKit 访问令牌。
    *   **连接管理:** 使用 `livekit-client` SDK 管理与 LiveKit 服务器的连接、断开连接。
    *   **角色处理:** 用户加入时，根据选择的角色（主播/观众）决定是否自动发布本地音视频。

5.  **实现媒体流处理:**
    *   **发布 (主播):** 获取本地摄像头和麦克风权限，创建并发布本地音视频轨道。
    *   **订阅 (主播和观众):** 监听房间事件，自动订阅并渲染远程参与者的音视频轨道。
    *   **UI 更新:** 动态添加/移除参与者的视频/音频元素。

6.  **状态管理:**
    *   使用 React Hooks (`useState`, `useEffect` 等) 管理房间连接状态、参与者列表、媒体轨道状态等。

## 组件交互流程

```mermaid
graph TD
    A[用户进入页面 /livekit-test] --> B(输入用户名和房间名);
    B --> C{选择角色: 主播/观众};
    C -- 主播 --> D(点击 "加入房间");
    C -- 观众 --> D;
    D --> E{调用后端 Token 接口};
    E --> F[使用 Token 连接 LiveKit 房间];
    F -- 连接成功 --> G{渲染基础 UI};
    G -- 主播 --> H(点击 "开始直播");
    H --> I[获取本地音视频并发布];
    G -- 观众/主播 --> J[监听并订阅远程参与者音视频];
    I --> K(在本地预览区显示自己);
    J --> L(在远程视频区显示他人);
    M[用户操作: 开/关音视频] --> N(更新 Track 状态);
    O[用户点击 "离开房间"] --> P[断开 LiveKit 连接];

    subgraph LiveKit交互
        I; J; N; P;
    end

    subgraph UI更新
        K; L;
    end
